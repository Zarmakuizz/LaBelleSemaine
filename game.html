<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>jQuery UI Droppable - Revert draggable position</title>
<!--<link rel="stylesheet" href="jquery_ui/themes/base/jquery.ui.all.css">-->
<script src="jquery_ui/jquery-1.9.1.js"></script>
<script src="jquery_ui/ui/jquery.ui.core.js"></script>
<script src="jquery_ui/ui/jquery.ui.widget.js"></script>
<script src="jquery_ui/ui/jquery.ui.mouse.js"></script>
<script src="jquery_ui/ui/jquery.ui.draggable.js"></script>
<script src="jquery_ui/ui/jquery.ui.droppable.js"></script>
<link rel="stylesheet" href="jquery_ui/demos/demos.css">
<link rel="stylesheet" href="css/style.css">
<script>

$(function() {
    days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
    difficulty = sessionStorage.getItem("difficulty");
    tuto = sessionStorage.getItem("tutorial");
    sessionStorage.removeItem("tutorial");

    if(tuto) {
        var $container = $("#tutorial").css('visibility', 'visible');
    }

    function randomize(divName)
    {
        var $container = $("#"+divName);
        children = $container.children().get();

        var pos = Array(7);
        for(var i=0; i<children.length; i++) {
            pos[i] = Array($(children[i]).css('top'), $(children[i]).css('left'));
        }

        shuffle(pos);

        for(var i=0; i<pos.length; i++) {
            $(children[i]).css('top', pos[i][0])
            $(children[i]).css('left', pos[i][1]);
        }
        

        function shuffle(o){
            for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
            return o;
        };
    }

    function reset() {
        window.location.reload();
    }

    randomize("unsorted_days");


    var correct_days = 0;

    function move(dragId, dropId) {
        dragElement = $("#"+dragId);
        dropElement = $("#"+dropId);
        
        // add class dropped to the div on drop
        $("#"+dropId).addClass('dropped');

        // Detach from original div, and attach to dropped one so that it can
        // be centered in css
        dragElement.detach().css({top: 0,left: 0}).appendTo(dropElement);
        dragElement.draggable('disable');

        if(++correct_days == 7) {
            window.location.href = 'victory.html';
        };
    }
    function drop_check(event, ui) {
        dropId = $(this).attr("id");
        dragId = ui.draggable.attr("id");
        move(dragId, dropId);
    };
    
    function on_drag_start(event, ui) {
        dragId = $(this).attr("id");
        dragElement = $("#"+dragId);

        day = this.id.replace("drag_", "");
        $("#drop_"+day).addClass('drop-here');

        $("#tutorial_text").text("Glisser le jour au bon endroit sur la timeline.");
    };
    function on_drag_stop(event, ui) {
        dragId = $(this).attr("id");
        dragElement = $("#"+dragId);

        $("#tutorial_text").text("Selectionnez un jour dans le nuage");
        console.log("reset");

        day = this.id.replace("drag_", "");
        $("#drop_"+day).removeClass('drop-here');
    };
    
    for(var i=0; i<days.length; i++) {
       // Set revert property when day is dropped in the wrong place
       $( "#drag_"+days[i] ).draggable({ revert: "invalid",
                                         start: on_drag_start,
                                         stop: on_drag_stop });
    
        // Play sound when days are clicked
        $("#unsorted_days").on( "click", "#drag_"+days[i], function() {
                var day = this.id.replace("drag_", "");
                document.getElementById("audio_"+day).play();
                });
    
        $("#drop_"+days[i]).droppable({
            accept:"#drag_"+days[i],
            activeClass: "ui-state-hover",
            hoverClass: "ui-state-active",
            drop: drop_check
            });
    
    }
    random_solve(difficulty);
    function random_solve(nb_div) {
        var placed = Array(nb_div);
        for(var i=0; i<nb_div; i++) {
            var day = parseInt(Math.random()*7);
            placed[i] = day;
            while(placed.indexOf(day) > -1) {
                day = parseInt(Math.random()*7);
            }
            placed[i] = day;
            console.log(placed);
            move("drag_"+days[day], "drop_"+days[day]);
        }
    }
});
</script>
</head>
<body>

<div id="game">
<h1> Consigne du jeu </h1>
<p>Les jours de la semaine sont en d√©sordre dans le nuage. Range-les dans le bon ordre !</p>
<div id="unsorted_days">
    <div id="drag_monday" class="cloudbox ui-widget-content">
    Lundi
    <audio id="audio_monday" preload>
      <source src="sound/01-Lundi.ogg" type="audio/ogg">
      <source src="sound/01-Lundi.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>

    <div id="drag_tuesday" class="cloudbox ui-widget-content">
    Mardi
    <audio id="audio_tuesday" preload>
      <source src="sound/02-Mardi.ogg" type="audio/ogg">
      <source src="sound/02-Mardi.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>

    <div id="drag_wednesday" class="cloudbox ui-widget-content">
    Mercredi
    <audio id="audio_wednesday" preload>
      <source src="sound/03-Mercredi.ogg" type="audio/ogg">
      <source src="sound/03-Mercredi.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>

    <div id="drag_thursday" class="cloudbox ui-widget-content">
    Jeudi
    <audio id="audio_thursday" preload>
      <source src="sound/04-Jeudi.ogg" type="audio/ogg">
      <source src="sound/04-Jeudi.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>

    <div id="drag_friday" class="cloudbox ui-widget-content">
    Vendredi
    <audio id="audio_friday" preload>
      <source src="sound/05-Vendredi.ogg" type="audio/ogg">
      <source src="sound/05-Vendredi.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>

    <div id="drag_saturday" class="cloudbox ui-widget-content">
    Samedi
    <audio id="audio_saturday" preload>
      <source src="sound/06-Samedi.ogg" type="audio/ogg">
      <source src="sound/06-Samedi.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>

    <div id="drag_sunday" class="cloudbox ui-widget-content">
    Dimanche
    <audio id="audio_sunday" preload>
      <source src="sound/07-Dimanche.ogg" type="audio/ogg">
      <source src="sound/07-Dimanche.mp3" type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    </div>
</div>

<div id="sorted_days">
    <div class="line"></div>
    <div id="drop_monday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>

    <div id="drop_tuesday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>

    <div id="drop_wednesday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>

    <div id="drop_thursday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>

    <div id="drop_friday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>

    <div id="drop_saturday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>

    <div id="drop_sunday" class="timelinebox ui-widget-header">
    <p> </p>
    </div>
    <div class="arrowbox"><img src="img/arrow.png" alt="arrow" class="arrow"/></div>
    </div>
</div>

<div id="tutorial" style="visibility:hidden">
<p id="tutorial_text">Selectionnez un jour dans le nuage</p>
</div>

</body>
</html>
